{"ast":null,"code":"import { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue';\nexport default {\n  __name: 'PoiBottomCard',\n  props: {\n    poi: {\n      type: Object,\n      required: true\n    }\n  },\n  emits: ['close', 'navigate', 'detail'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n\n    /* eslint-env vue/setup-compiler-macros */\n\n    const emit = __emit;\n    const sheet = ref(null);\n    const expanded = ref(false);\n    let startY = 0;\n    let currentY = 0;\n    let lastY = 0;\n    let dragging = false;\n    let maxTranslate = 0;\n\n    // 监听展开状态并通知父组件\n    watch(expanded, v => {\n      emit('expanded', !!v);\n    });\n    function updateMaxTranslate() {\n      const el = sheet.value;\n      if (!el) return;\n      maxTranslate = el.clientHeight - 96; // collapsed height ~96px\n    }\n    function onPointerDown(e) {\n      dragging = true;\n      startY = e.clientY;\n      lastY = startY;\n      document.addEventListener('pointermove', onPointerMove);\n      document.addEventListener('pointerup', onPointerUp);\n      sheet.value.style.transition = 'none';\n    }\n    function onPointerMove(e) {\n      if (!dragging) return;\n      currentY = e.clientY;\n      const delta = currentY - startY;\n      // if expanded, allow dragging down to collapse; if collapsed, dragging up expands\n      let translate = (expanded.value ? 0 : maxTranslate) + delta;\n      translate = Math.max(0, Math.min(maxTranslate, translate));\n      sheet.value.style.transform = `translateY(${translate}px)`;\n      lastY = currentY;\n    }\n    function onPointerUp() {\n      dragging = false;\n      document.removeEventListener('pointermove', onPointerMove);\n      document.removeEventListener('pointerup', onPointerUp);\n      sheet.value.style.transition = '';\n      const deltaTotal = lastY - startY;\n      // if dragged more than 40px, toggle\n      if (Math.abs(deltaTotal) > 40) {\n        if (deltaTotal < 0) {\n          // dragged up\n          expanded.value = true;\n        } else {\n          // dragged down\n          expanded.value = false;\n        }\n      } else {\n        expanded.value = !expanded.value;\n      }\n      // reset transform\n      sheet.value.style.transform = '';\n      // emit expanded change happens via watch\n    }\n    function toggle() {\n      expanded.value = !expanded.value;\n      // notify parent immediately (watch also covers changes)\n      emit('expanded', !!expanded.value);\n    }\n    onMounted(() => {\n      updateMaxTranslate();\n      window.addEventListener('resize', updateMaxTranslate);\n      // notify initial collapsed state\n      emit('expanded', !!expanded.value);\n    });\n    onBeforeUnmount(() => {\n      window.removeEventListener('resize', updateMaxTranslate);\n    });\n    const sheetStyle = computed(() => ({\n      bottom: '0',\n      // when expanded, full height; when collapsed, show only 96px height visual\n      height: expanded.value ? '50vh' : '96px'\n    }));\n    const __returned__ = {\n      emit,\n      sheet,\n      expanded,\n      get startY() {\n        return startY;\n      },\n      set startY(v) {\n        startY = v;\n      },\n      get currentY() {\n        return currentY;\n      },\n      set currentY(v) {\n        currentY = v;\n      },\n      get lastY() {\n        return lastY;\n      },\n      set lastY(v) {\n        lastY = v;\n      },\n      get dragging() {\n        return dragging;\n      },\n      set dragging(v) {\n        dragging = v;\n      },\n      get maxTranslate() {\n        return maxTranslate;\n      },\n      set maxTranslate(v) {\n        maxTranslate = v;\n      },\n      updateMaxTranslate,\n      onPointerDown,\n      onPointerMove,\n      onPointerUp,\n      toggle,\n      sheetStyle,\n      ref,\n      onMounted,\n      onBeforeUnmount,\n      watch,\n      computed\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onBeforeUnmount","watch","computed","emit","__emit","sheet","expanded","startY","currentY","lastY","dragging","maxTranslate","v","updateMaxTranslate","el","value","clientHeight","onPointerDown","e","clientY","document","addEventListener","onPointerMove","onPointerUp","style","transition","delta","translate","Math","max","min","transform","removeEventListener","deltaTotal","abs","toggle","window","sheetStyle","bottom","height"],"sources":["E:/jiangjie-museum/GitHub/jiangjie-museum/src/components/PoiBottomCard.vue"],"sourcesContent":["<template>\r\n  <div class=\"bottom-sheet-wrapper\" @click.self=\"$emit('close')\">\r\n    <div\r\n      class=\"bottom-sheet\"\r\n      :class=\"{ expanded }\r\n      \"\r\n      :style=\"sheetStyle\"\r\n      ref=\"sheet\"\r\n      @pointerdown=\"onPointerDown\"\r\n    >\r\n      <div class=\"handle\" @click.stop=\"toggle\">\r\n        <div class=\"bar\"></div>\r\n      </div>\r\n\r\n      <div class=\"content\">\r\n        <img class=\"thumb\" :src=\"poi.img\" :alt=\"poi.title\" />\r\n        <div class=\"meta\">\r\n          <div class=\"title\">{{ poi.title }}</div>\r\n          <div class=\"desc\">{{ poi.desc }}</div>\r\n          <div class=\"actions\">\r\n            <button class=\"primary\" @click.stop=\"$emit('navigate')\">选定并开始导航</button>\r\n            <button class=\"secondary\" @click.stop=\"$emit('detail', poi)\">查看详情</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n/* eslint-env vue/setup-compiler-macros */\r\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue'\r\ndefineProps({\r\n  poi: { type: Object, required: true }\r\n})\r\nconst emit = defineEmits(['close','navigate','detail'])\r\n\r\nconst sheet = ref(null)\r\nconst expanded = ref(false)\r\nlet startY = 0\r\nlet currentY = 0\r\nlet lastY = 0\r\nlet dragging = false\r\nlet maxTranslate = 0\r\n\r\n// 监听展开状态并通知父组件\r\nwatch(expanded, v => {\r\n  emit('expanded', !!v)\r\n})\r\n\r\nfunction updateMaxTranslate(){\r\n  const el = sheet.value\r\n  if(!el) return\r\n  maxTranslate = el.clientHeight - 96 // collapsed height ~96px\r\n}\r\n\r\nfunction onPointerDown(e){\r\n  dragging = true\r\n  startY = e.clientY\r\n  lastY = startY\r\n  document.addEventListener('pointermove', onPointerMove)\r\n  document.addEventListener('pointerup', onPointerUp)\r\n  sheet.value.style.transition = 'none'\r\n}\r\nfunction onPointerMove(e){\r\n  if(!dragging) return\r\n  currentY = e.clientY\r\n  const delta = currentY - startY\r\n  // if expanded, allow dragging down to collapse; if collapsed, dragging up expands\r\n  let translate = (expanded.value ? 0 : maxTranslate) + delta\r\n  translate = Math.max(0, Math.min(maxTranslate, translate))\r\n  sheet.value.style.transform = `translateY(${translate}px)`\r\n  lastY = currentY\r\n}\r\nfunction onPointerUp(){\r\n  dragging = false\r\n  document.removeEventListener('pointermove', onPointerMove)\r\n  document.removeEventListener('pointerup', onPointerUp)\r\n  sheet.value.style.transition = ''\r\n  const deltaTotal = lastY - startY\r\n  // if dragged more than 40px, toggle\r\n  if(Math.abs(deltaTotal) > 40){\r\n    if(deltaTotal < 0){ // dragged up\r\n      expanded.value = true\r\n    }else{ // dragged down\r\n      expanded.value = false\r\n    }\r\n  }else{\r\n    expanded.value = !expanded.value\r\n  }\r\n  // reset transform\r\n  sheet.value.style.transform = ''\r\n  // emit expanded change happens via watch\r\n}\r\n\r\nfunction toggle(){\r\n  expanded.value = !expanded.value\r\n  // notify parent immediately (watch also covers changes)\r\n  emit('expanded', !!expanded.value)\r\n}\r\n\r\nonMounted(()=>{\r\n  updateMaxTranslate()\r\n  window.addEventListener('resize', updateMaxTranslate)\r\n  // notify initial collapsed state\r\n  emit('expanded', !!expanded.value)\r\n})\r\nonBeforeUnmount(()=>{\r\n  window.removeEventListener('resize', updateMaxTranslate)\r\n})\r\n\r\nconst sheetStyle = computed(()=>({\r\n  bottom: '0',\r\n  // when expanded, full height; when collapsed, show only 96px height visual\r\n  height: expanded.value ? '50vh' : '96px'\r\n}))\r\n</script>\r\n\r\n<style scoped>\r\n.bottom-sheet-wrapper{position:fixed;left:0;right:0;bottom:0;top:0;z-index:80;display:flex;align-items:flex-end;justify-content:center;pointer-events:auto}\r\n.bottom-sheet-wrapper::before{content:'';position:absolute;inset:0;background:transparent}\r\n.bottom-sheet{position:relative;background:#fff;border-top-left-radius:14px;border-top-right-radius:14px;width:100%;max-width:680px;box-shadow:0 -12px 36px rgba(0,0,0,0.12);overflow:hidden;transition:height .28s cubic-bezier(.2,.9,.3,1),transform .18s ease}\r\n.handle{height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer}\r\n.handle .bar{width:42px;height:6px;background:#e6e6e6;border-radius:6px}\r\n.content{display:flex;gap:12px;padding:8px 16px 18px;align-items:center}\r\n.thumb{width:84px;height:64px;border-radius:8px;object-fit:cover;box-shadow:0 8px 22px rgba(0,0,0,0.12)}\r\n.meta{flex:1}\r\n.title{font-weight:700;margin-bottom:6px}\r\n.desc{font-size:12px;color:#666;margin-bottom:8px}\r\n.actions{display:flex;gap:10px}\r\n.primary{background:#d8332a;color:#fff;border:none;padding:8px 12px;border-radius:8px}\r\n.secondary{background:#f5f5f5;border:none;padding:8px 12px;border-radius:8px}\r\n\r\n/* expanded layout tweaks */\r\n.bottom-sheet.expanded{height:50vh}\r\n\r\n@media (max-width:420px){\r\n  .bottom-sheet{border-radius:12px}\r\n  .thumb{width:68px;height:52px}\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}